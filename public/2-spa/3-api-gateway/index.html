<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.69.0" />
    <meta name="description" content="">
<meta name="author" content="journeyoftheaverageguy@gmail.com">

    <link rel="icon" href="/images/favicon.png" type="image/png">

    <title>Create and Expose the API :: DevAx - Monoliths to Microservices - Creating an Authenticated Single Page Application (SPA)</title>

    
    <link href="/css/nucleus.css?1622779992" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css?1622779992" rel="stylesheet">
    <link href="/css/hybrid.css?1622779992" rel="stylesheet">
    <link href="/css/featherlight.min.css?1622779992" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1622779992" rel="stylesheet">
    <link href="/css/auto-complete.css?1622779992" rel="stylesheet">
    <link href="/css/atom-one-dark-reasonable.css?1622779992" rel="stylesheet">
    <link href="/css/theme.css?1622779992" rel="stylesheet">
    <link href="/css/hugo-theme.css?1622779992" rel="stylesheet">
    
    <link href="/css/theme-workshop.css?1622779992" rel="stylesheet">
    
    

    <script src="/js/jquery-3.3.1.min.js?1622779992"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="/2-spa/3-api-gateway/">
    <nav id="sidebar" class="showVisitedLinks">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="/">

<svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30" width="30%"><defs><style>.cls-1{fill:#fff;}.cls-2{fill:#f90;fill-rule:evenodd;}</style></defs><title>AWS-Logo_White-Color</title><path class="cls-1" d="M14.09,10.85a4.7,4.7,0,0,0,.19,1.48,7.73,7.73,0,0,0,.54,1.19.77.77,0,0,1,.12.38.64.64,0,0,1-.32.49l-1,.7a.83.83,0,0,1-.44.15.69.69,0,0,1-.49-.23,3.8,3.8,0,0,1-.6-.77q-.25-.42-.51-1a6.14,6.14,0,0,1-4.89,2.3,4.54,4.54,0,0,1-3.32-1.19,4.27,4.27,0,0,1-1.22-3.2A4.28,4.28,0,0,1,3.61,7.75,6.06,6.06,0,0,1,7.69,6.46a12.47,12.47,0,0,1,1.76.13q.92.13,1.91.36V5.73a3.65,3.65,0,0,0-.79-2.66A3.81,3.81,0,0,0,7.86,2.3a7.71,7.71,0,0,0-1.79.22,12.78,12.78,0,0,0-1.79.57,4.55,4.55,0,0,1-.58.22l-.26,0q-.35,0-.35-.52V2a1.09,1.09,0,0,1,.12-.58,1.2,1.2,0,0,1,.47-.35A10.88,10.88,0,0,1,5.77.32,10.19,10.19,0,0,1,8.36,0a6,6,0,0,1,4.35,1.35,5.49,5.49,0,0,1,1.38,4.09ZM7.34,13.38a5.36,5.36,0,0,0,1.72-.31A3.63,3.63,0,0,0,10.63,12,2.62,2.62,0,0,0,11.19,11a5.63,5.63,0,0,0,.16-1.44v-.7a14.35,14.35,0,0,0-1.53-.28,12.37,12.37,0,0,0-1.56-.1,3.84,3.84,0,0,0-2.47.67A2.34,2.34,0,0,0,5,11a2.35,2.35,0,0,0,.61,1.76A2.4,2.4,0,0,0,7.34,13.38Zm13.35,1.8a1,1,0,0,1-.64-.16,1.3,1.3,0,0,1-.35-.65L15.81,1.51a3,3,0,0,1-.15-.67.36.36,0,0,1,.41-.41H17.7a1,1,0,0,1,.65.16,1.4,1.4,0,0,1,.33.65l2.79,11,2.59-11A1.17,1.17,0,0,1,24.39.6a1.1,1.1,0,0,1,.67-.16H26.4a1.1,1.1,0,0,1,.67.16,1.17,1.17,0,0,1,.32.65L30,12.39,32.88,1.25A1.39,1.39,0,0,1,33.22.6a1,1,0,0,1,.65-.16h1.54a.36.36,0,0,1,.41.41,1.36,1.36,0,0,1,0,.26,3.64,3.64,0,0,1-.12.41l-4,12.86a1.3,1.3,0,0,1-.35.65,1,1,0,0,1-.64.16H29.25a1,1,0,0,1-.67-.17,1.26,1.26,0,0,1-.32-.67L25.67,3.64,23.11,14.34a1.26,1.26,0,0,1-.32.67,1,1,0,0,1-.67.17Zm21.36.44a11.28,11.28,0,0,1-2.56-.29,7.44,7.44,0,0,1-1.92-.67,1,1,0,0,1-.61-.93v-.84q0-.52.38-.52a.9.9,0,0,1,.31.06l.42.17a8.77,8.77,0,0,0,1.83.58,9.78,9.78,0,0,0,2,.2,4.48,4.48,0,0,0,2.43-.55,1.76,1.76,0,0,0,.86-1.57,1.61,1.61,0,0,0-.45-1.16A4.29,4.29,0,0,0,43,9.22l-2.41-.76A5.15,5.15,0,0,1,38,6.78a3.94,3.94,0,0,1-.83-2.41,3.7,3.7,0,0,1,.45-1.85,4.47,4.47,0,0,1,1.19-1.37A5.27,5.27,0,0,1,40.51.29,7.4,7.4,0,0,1,42.6,0a8.87,8.87,0,0,1,1.12.07q.57.07,1.08.19t.95.26a4.27,4.27,0,0,1,.7.29,1.59,1.59,0,0,1,.49.41.94.94,0,0,1,.15.55v.79q0,.52-.38.52a1.76,1.76,0,0,1-.64-.2,7.74,7.74,0,0,0-3.2-.64,4.37,4.37,0,0,0-2.21.47,1.6,1.6,0,0,0-.79,1.48,1.58,1.58,0,0,0,.49,1.18,4.94,4.94,0,0,0,1.83.92L44.55,7a5.08,5.08,0,0,1,2.57,1.6A3.76,3.76,0,0,1,47.9,11a4.21,4.21,0,0,1-.44,1.93,4.4,4.4,0,0,1-1.21,1.47,5.43,5.43,0,0,1-1.85.93A8.25,8.25,0,0,1,42.05,15.62Z"></path><path class="cls-2" d="M45.19,23.81C39.72,27.85,31.78,30,25,30A36.64,36.64,0,0,1,.22,20.57c-.51-.46-.06-1.09.56-.74A49.78,49.78,0,0,0,25.53,26.4,49.23,49.23,0,0,0,44.4,22.53C45.32,22.14,46.1,23.14,45.19,23.81Z"></path><path class="cls-2" d="M47.47,21.21c-.7-.9-4.63-.42-6.39-.21-.53.06-.62-.4-.14-.74,3.13-2.2,8.27-1.57,8.86-.83s-.16,5.89-3.09,8.35c-.45.38-.88.18-.68-.32C46.69,25.8,48.17,22.11,47.47,21.21Z"></path></svg>

</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/js/lunr.min.js?1622779992"></script>
<script type="text/javascript" src="/js/auto-complete.js?1622779992"></script>
<script type="text/javascript">
    
        var baseurl = "";
    
</script>
<script type="text/javascript" src="/js/search.js?1622779992"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/1-prerequisites/" title="Prerequisites" class="dd-item 
        
        
        
        ">
      <a href="/1-prerequisites/">
          <b>1. </b>Prerequisites
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/1-prerequisites/1-create-environment/" title="Create Environment" class="dd-item 
        
        
        
        ">
      <a href="/1-prerequisites/1-create-environment/">
          <b>1.1. </b>Create Environment
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/1-prerequisites/1-create-environment/1-vpc/" title="VPC" class="dd-item 
        
        
        
        ">
      <a href="/1-prerequisites/1-create-environment/1-vpc/">
          <b>1.1.1. </b>VPC
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/1-prerequisites/1-create-environment/2-ec2/" title="EC2" class="dd-item 
        
        
        
        ">
      <a href="/1-prerequisites/1-create-environment/2-ec2/">
          <b>1.1.2. </b>EC2
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/1-prerequisites/1-create-environment/3-rds/" title="RDS" class="dd-item 
        
        
        
        ">
      <a href="/1-prerequisites/1-create-environment/3-rds/">
          <b>1.1.3. </b>RDS
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/1-prerequisites/2-remote-env-config-cli/" title="Remote enviroment &amp; Configure the AWS CLI" class="dd-item 
        
        
        
        ">
      <a href="/1-prerequisites/2-remote-env-config-cli/">
          <b>1.2. </b>Remote enviroment &amp; Configure the AWS CLI
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/2-spa/" title="Single Page Application" class="dd-item 
        parent
        
        
        ">
      <a href="/2-spa/">
          <b>2. </b>Single Page Application
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/2-spa/1-prerequisites/" title="Pre-requisites" class="dd-item 
        
        
        
        ">
      <a href="/2-spa/1-prerequisites/">
          <b>2.1. </b>Pre-requisites
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/2-spa/1-prerequisites/a/" title="Eclipse Environment" class="dd-item 
        
        
        
        ">
      <a href="/2-spa/1-prerequisites/a/">
          <b>Option A. </b>Eclipse Environment
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/2-spa/1-prerequisites/b/" title="AWS Cloud9 Environment" class="dd-item 
        
        
        
        ">
      <a href="/2-spa/1-prerequisites/b/">
          <b>Option B. </b>AWS Cloud9 Environment
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/2-spa/2-build-deploy/" title="Serverless Microservices" class="dd-item 
        
        
        
        ">
      <a href="/2-spa/2-build-deploy/">
          <b>2.2. </b>Serverless Microservices
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/2-spa/3-api-gateway/" title="Create and Expose the API" class="dd-item 
        
        active
        
        ">
      <a href="/2-spa/3-api-gateway/">
          <b>2.3. </b>Create and Expose the API
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/2-spa/4-codestar-cicd/" title="Deploy the API using CodeStar and CI/CD" class="dd-item 
        
        
        
        ">
      <a href="/2-spa/4-codestar-cicd/">
          <b>2.4. </b>Deploy the API using CodeStar and CI/CD
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/2-spa/4-codestar-cicd/a/" title="Eclipse Environment" class="dd-item 
        
        
        
        ">
      <a href="/2-spa/4-codestar-cicd/a/">
          <b>Option A. </b>Eclipse Environment
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/2-spa/4-codestar-cicd/b/" title="AWS Cloud9 Environment" class="dd-item 
        
        
        
        ">
      <a href="/2-spa/4-codestar-cicd/b/">
          <b>Option B. </b>AWS Cloud9 Environment
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/2-spa/5-setup-spa/" title="Setup the SPA Webpage" class="dd-item 
        
        
        
        ">
      <a href="/2-spa/5-setup-spa/">
          <b>2.5. </b>Setup the SPA Webpage
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/2-spa/6-consume-api/" title="Consume the API" class="dd-item 
        
        
        
        ">
      <a href="/2-spa/6-consume-api/">
          <b>2.6. </b>Consume the API
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/3-aaa/" title="Configure AAA" class="dd-item 
        
        
        
        ">
      <a href="/3-aaa/">
          <b>3. </b>Configure AAA
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/3-aaa/1-cognito/" title="SPA Authentication" class="dd-item 
        
        
        
        ">
      <a href="/3-aaa/1-cognito/">
          <b>3.1. </b>SPA Authentication
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/3-aaa/2-microservice-authen/" title="Microservice Authentication" class="dd-item 
        
        
        
        ">
      <a href="/3-aaa/2-microservice-authen/">
          <b>3.2. </b>Microservice Authentication
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/3-aaa/3-deploy-test/" title="Deploy and Test" class="dd-item 
        
        
        
        ">
      <a href="/3-aaa/3-deploy-test/">
          <b>3.3. </b>Deploy and Test
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/3-aaa/4-signup-signin/" title="User Sign Up/Sign In" class="dd-item 
        
        
        
        ">
      <a href="/3-aaa/4-signup-signin/">
          <b>3.4. </b>User Sign Up/Sign In
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/4-xray/" title="Application Performance" class="dd-item 
        
        
        
        ">
      <a href="/4-xray/">
          <b>4. </b>Application Performance
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/5-challenge/" title="Challenge" class="dd-item 
        
        
        
        ">
      <a href="/5-challenge/">
          <b>5. </b>Challenge
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/6-conclusion/" title="Conclusion" class="dd-item 
        
        
        
        ">
      <a href="/6-conclusion/">
          <b>6. </b>Conclusion
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/7-resources/" title="Reference resources" class="dd-item 
        
        
        
        ">
      <a href="/7-resources/">
          <b>7. </b>Reference resources
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
         
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li> 
                  <a class="padding" href="http://awsstudygroup.com"><i class='fab fa-aws'></i> AWS Study Group - Blog</a>
              </li>
          
              <li> 
                  <a class="padding" href="https://www.facebook.com/groups/660548818043427/"><i class='fab fa-facebook'></i> AWS Study Group - FB Group</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="prefooter">
      <hr/>
      <ul>
      
        <li>
          <a class="padding">
            <i class="fas fa-language fa-fw"></i>
          <div class="select-style">
            <select id="select-language" onchange="location = this.value;">
          
          
          
              
              
                  
                    
                    
                      <option id="en" value="/2-spa/3-api-gateway/" selected>English</option>
                    
                  
              
                  
              
          
              
              
                  
              
                  
                    
                    
                      <option id="vi" value="/vi/2-spa/3-api-gateway/">Tiếng Việt</option>
                    
                  
              
          
        </select>
        <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
          width="255px" height="255px" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255;" xml:space="preserve">
          <g>
            <g id="arrow-drop-down">
              <polygon points="0,63.75 127.5,191.25 255,63.75 		" />
            </g>
          </g>
        </svg>
        </div>
        </a>
        </li>
      
      
      
        <li><a class="padding" href="#" data-clear-history-toggle=""><i class="fas fa-history fa-fw"></i> Clear History</a></li>
      
      </ul>
    </section>
    
    <section id="footer">
      <left>
    
    

    

    
</left>

<script async defer src="https://buttons.github.io/buttons.js"></script>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='/'>Creating an Authenticated Single Page Application (SPA)</a> > <a href='/2-spa/'>Single Page Application</a> > Create and Expose the API
          
        
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Create and Expose the API
            </h1>
          

        



	<p><strong>Create and Expose the API with Amazon API Gateway</strong></p>
<p>Now that you have created the Lambda functions, it is time to manually create the API Gateway deployment that will expose the microservice as an API.</p>
<p><strong>Contents</strong></p>
<ul>
<li><a href="#expose-the-tripsfromcity-restful-api-endpoint">Expose the <strong>/tripsfromcity</strong> RESTful API endpoint</a></li>
<li><a href="#expose-the-tripstocity-restful-api-endpoint">Expose the <strong>/tripstocity</strong> RESTful API endpoint</a></li>
<li><a href="#deploy-the-api-and-test">Deploy the API and test</a></li>
<li><a href="#exercise-2---use-cloudformationsam-via-the-aws-cli-to-deploy-the-hotelsearch-microservice">Exercise 2 - Use CloudFormation/SAM via the AWS CLI to deploy the HotelSearch microservice</a></li>
<li><a href="#test-the-hotelspecials-api">Test the HotelSpecials API</a></li>
</ul>
<ol>
<li>Open the <strong>AWS API Gateway console</strong> by clicking <strong>Services</strong> and typing <code>api</code> in the filter box. Press <strong>Enter</strong>.</li>
<li>Click <strong>Get Started</strong> if shown.</li>
<li>Go to create REST API and click <strong>Build</strong>. Make sure <strong>not</strong> to click the option with the word &ldquo;<strong>Private</strong>&quot;.</li>
</ol>
<p><img src="/images/2/6.png?width=90pc" alt="API Gateway"></p>
<p><img src="/images/2/7.png?width=90pc" alt="API Gateway"></p>
<ol start="4">
<li>If a new screen comes up, click <strong>OK</strong>. Make sure you have <strong>New API</strong> radio button <strong>selected</strong>:</li>
</ol>
<p><img src="/images/2/8.png?width=90pc" alt="API Gateway"></p>
<ol start="5">
<li>For <strong>API Name</strong> type <code>iDevelop - Trip Search API</code></li>
<li>For <strong>Description</strong> type <strong>Allows searching for trips from/to cities</strong></li>
<li>Click <strong>Create API</strong>.</li>
</ol>
<p><img src="/images/2/9.png?width=90pc" alt="API Gateway"></p>
<ol start="8">
<li>The API will be created, and have a <strong>root</strong> path element and nothing else. Click on the <strong>/</strong> root path element and then click <strong>Actions</strong> to reveal the menu. Click <strong>Create Resource</strong>.</li>
</ol>
<p><img src="/images/2/10.png?width=90pc" alt="API Gateway"></p>
<ol start="9">
<li>In the <strong>New Child Resource</strong> panel, for <strong>Resource Name</strong> type <code>trips</code></li>
<li>For <strong>Resource Path</strong> type <code>trips</code></li>
<li>Check the <strong>Enable API Gateway CORS</strong> checkbox</li>
<li>Click <strong>Create Resource</strong></li>
</ol>
<p><img src="/images/2/11.png?width=90pc" alt="API Gateway"></p>
<ol start="13">
<li>The <strong>/trips</strong> resource will be created. Click on the <strong>/trips</strong> link, then click the <strong>Actions</strong> button and choose <strong>Create Method</strong>.</li>
</ol>
<p><img src="/images/2/12.png?width=90pc" alt="API Gateway"></p>
<ol start="14">
<li>In the dropdown list that appears, choose <strong>GET</strong></li>
</ol>
<p><img src="/images/2/13.png?width=90pc" alt="API Gateway"></p>
<ol start="15">
<li>Click the grey tick next to the dropdown list to commit the change.</li>
<li>The <strong>/trips - GET - Setup</strong> panel will appear. For <strong>Lambda Region</strong> select <code>ap-northeast-1</code> (or your region)</li>
<li>In the <strong>Lambda Function</strong> field, type <code>idevelop</code> to reveal the available functions in the region and select <code>idevelopTripSearchFull</code>.</li>
</ol>
<p><img src="/images/2/14.png?width=90pc" alt="API Gateway"></p>
<ol start="18">
<li>Click <strong>Save</strong>.</li>
<li>In the dialog that appears regarding adding permissions to Lambda, click <strong>OK</strong>.</li>
<li>When the method is created, you will see the <strong>Method Execution</strong> panel:</li>
</ol>
<p><img src="/images/2/15.png?width=90pc" alt="API Gateway"></p>
<p>To test that the Lambda function is being called from the API, click the <strong>Test</strong> button.</p>
<ol start="21">
<li>In the <strong>Method Test</strong> panel, scroll down to reveal the <strong>Test</strong> button.</li>
</ol>
<p><img src="/images/2/16.png?width=90pc" alt="API Gateway"></p>
<ol start="22">
<li>Click the <strong>Test</strong> button. After a moment or two for the Lambda function to initialise and execute, you should see an output similar to this:</li>
</ol>
<p><img src="/images/2/17.png?width=90pc" alt="API Gateway">

<div class="notices note" ><p>Note that the data you see will be different because it is randomly generated by the lab setup process.</p>
</div>
</p>
<ol start="23">
<li>To allow access from a web browser, you need to enable CORS - Cross-origin scripting. Click on the <strong>/trips</strong> node and from the <strong>Actions</strong> menu, select <strong>Enable CORS</strong>.</li>
<li>Click <strong>Enable CORS and replace existing CORS headers</strong>.</li>
<li>On the dialog that appears, click <strong>Yes, replace existing values</strong>. When each of the listed items have a <strong>green tick</strong> against them, you can move on to the next section. This will only take a moment.</li>
</ol>
<h4 id="expose-the-tripsfromcity-restful-api-endpoint">Expose the <strong>/tripsfromcity</strong> RESTful API endpoint</h4>
<p>The first path we exposed was quite simple - /trips gets all the trips in the system. But we know our source code implementation allows us to specify a filter to query for trips that <strong>originate</strong> from a particular city or have a particular <strong>destination</strong>, so we want to expose this functionality to our API consumers. First, we will expose the <strong>/tripsfromcity</strong> path.</p>
<ol start="26">
<li>Click the <strong>/</strong> root element in the <strong>Resources</strong> tree</li>
<li>From the <strong>Actions</strong> menu choose <strong>Create Resource</strong></li>
<li>For <strong>Resource Name</strong> type <code>tripsfromcity</code></li>
<li>Check the <strong>Enable API Gateway CORS</strong> checkbox</li>
<li>Click <strong>Create Resource</strong></li>
<li>Our call into the Lambda function requires a <strong>city</strong> parameter. We will follow the standard pattern for RESTful interfaces, and pass this parameter in as a URL parameter. With the <strong>/tripsfromcity</strong> node selected, from the <strong>Actions</strong> menu select <strong>Create Resource</strong></li>
<li>For <strong>Resource Name</strong> type <code>{city}</code></li>
<li>For <strong>Resource Path</strong>, delete the default and replace with <code>{city}</code></li>
<li>Click <strong>Create Resource</strong></li>
<li>With the <strong>/{city}</strong> node selected, from the <strong>Actions</strong> menu select <strong>Create Method</strong></li>
<li>In the dropdown list that appears, choose <strong>GET</strong></li>
<li>Click the grey tick next to the dropdown list to commit the change.</li>
<li>The <strong>/tripsfromcity/{city} - GET - Setup</strong> panel will appear. For Lambda Region select <code>ap-northeast-1</code> (or your target region)</li>
<li>In the <strong>Lambda Function</strong> field, type <code>idevelop</code> to reveal the available functions in the region and select <code>idevelopTripSearchFromCity</code></li>
<li>Click <strong>Save</strong></li>
<li>In the dialog that appears regarding adding permissions to Lambda, click <strong>OK</strong></li>
<li>When the method is created, you will see the <strong>Method Execution</strong> panel, as before for the <strong>/trips</strong> resource. We can’t go ahead and test the API call just yet, because we need to transform the request through API Gateway so that the city parameter is passed through to the Lambda function correctly.</li>
</ol>
<p>The <strong>devlounge.lambda.FindTripsFromCityHandler</strong> handler expects to see the input data in this JSON format:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
	<span style="color:#f92672">&#34;payload&#34;</span> : 
	{
        <span style="color:#f92672">&#34;city&#34;</span>: <span style="color:#e6db74">&#34;Melbourne&#34;</span>
    }
}
</code></pre></div>
<div class="notices note" ><p>This would cause the Lambda function to search DynamoDB for all trips that originate from Melbourne. We need to add a <strong>Body Mapping Template</strong> for this method in API Gateway to correctly transform the request into this format.</p>
</div>

<ol start="43">
<li>In the <strong>/tripsfromcity/{city} - GET - Method Execution</strong> panel, click <strong>Integration Request</strong></li>
<li>Scroll down to <strong>Mapping Templates</strong> and open the section by clicking on the triangle to reveal the panel</li>
<li>Select the <strong>When there are no templates defined (recommended)</strong> option</li>
<li>Click <strong>Add mapping template</strong></li>
<li>For <strong>Content-Type</strong> type <code>application/json</code> and click the <strong>grey tick icon</strong> to commit the change</li>
<li>Scroll further down to show the mapping template entry text field. Paste in the following template:</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
    <span style="color:#f92672">&#34;payload&#34;</span> : {
        <span style="color:#f92672">&#34;city&#34;</span>: <span style="color:#e6db74">&#34;$input.params(&#39;city&#39;)&#34;</span>
    }
}
</code></pre></div><ol start="49">
<li>Click <strong>Save</strong>.</li>
</ol>
<p>This template will take the parameter <code>{city}</code> from the URL and add it into a JSON payload that is sent to the Lambda function, as a property of the <strong>payload</strong> object, just as the Lambda function expects.</p>
<p><img src="/images/2/18.png?width=90pc" alt="API Gateway"></p>

<div class="notices note" ><p>The schema defined here for this Lambda function is completely arbitrary, and in your own application you could use a completely different model. The mapping template gives you the flexibility to transform the inbound data on-the-fly through the API Gateway endpoint.</p>
</div>

<ol start="50">
<li>We can now test the API call. Click <strong>Method Execution</strong> to go back to the Method Execution panel.</li>
<li>Click <strong>Test</strong> to reveal the test panel</li>
<li>Under <strong>Path</strong>, for the <strong>{city}</strong> parameter, type <code>Melbourne</code></li>
<li>Click <strong>Test</strong></li>
</ol>
<p>API Gateway will make the call into the Lambda function, passing the value Melbourne into the Body Mapping Template you have defined, which will insert the search parameter Melbourne into the JSON payload that is sent to the Lambda function. This will cause the function handler to consume the JSON and execute a search in the DynamoDB table, and return the results. You will see a result similar to this:</p>
<p><img src="/images/2/19.png?width=90pc" alt="API Gateway"></p>
<ol start="54">
<li>To allow access from a web browser, you need to enable <strong>CORS - Cross-origin scripting</strong>. Click on the <strong>/tripsfromcity/{city}</strong> node and from the <strong>Actions</strong> menu, select <strong>Enable CORS</strong>.</li>
<li>Click <strong>Enable CORS and replace existing CORS headers</strong></li>
<li>On the dialog that appears, click <strong>Yes, replace existing values</strong>. When each of the listed items have a <strong>green tick</strong> against them, you can move on to the next section. This will only take a moment.</li>
</ol>
<h4 id="expose-the-tripstocity-restful-api-endpoint">Expose the <strong>/tripstocity</strong> RESTful API endpoint</h4>
<p>Next, we will expose the final resource for our <strong>Trips API</strong>, <strong>/tripstocity</strong>:</p>
<ol start="57">
<li>Click the <strong>/</strong> root element in the <strong>Resources</strong> tree</li>
<li>From the <strong>Actions</strong> menu choose <strong>Create Resource</strong></li>
<li>For <strong>Resource Name</strong> type <code>tripstocity</code></li>
<li>Check the <strong>Enable API Gateway CORS</strong> checkbox</li>
<li>Click <strong>Create Resource</strong></li>
<li>Our call into the Lambda function requires a <strong>city</strong> parameter. We will follow the standard pattern for RESTful interfaces, and pass this parameter in as a URL parameter. With the <strong>/tripstocity</strong> node selected, from the <strong>Actions</strong> menu select <strong>Create Resource</strong></li>
<li>For <strong>Resource Name</strong> type <code>{city}</code></li>
<li>For <strong>Resource Path</strong>, delete the default and replace with <code>{city}</code></li>
<li>Check the <strong>Enable API Gateway CORS</strong> checkbox</li>
<li>Click <strong>Create Resource</strong></li>
<li>With the <strong>/{city}</strong> node selected, from the <strong>Actions</strong> menu select <strong>Create Method</strong></li>
<li>In the dropdown list that appears, choose <strong>GET</strong></li>
<li>Click the grey tick next to the dropdown list to commit the change.</li>
<li>The <strong>/tripstocity/{city} - GET - Setup</strong> panel will appear. For Lambda Region select <code>ap-northeast-1</code> (or your target region)</li>
<li>In the <strong>Lambda Function</strong> field, type <code>idevelop</code> to reveal the available functions in the region and select <code>idevelopTripSearchToCity</code></li>
<li>Click <strong>Save</strong></li>
<li>In the dialog that appears regarding adding permissions to Lambda, click <strong>OK</strong></li>
<li>When the method is created, you will see the <strong>Method Execution</strong> panel, as before for the <strong>/trips</strong> resource. We can’t go ahead and test the API call just yet, because we need to transform the request through API Gateway so that the city parameter is passed through to the Lambda function correctly.</li>
</ol>
<p>The <strong>devlounge.lambda.FindTripsToCityHandler</strong> handler expects to see the input data in this JSON format:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
	<span style="color:#f92672">&#34;payload&#34;</span> : 
	{
        <span style="color:#f92672">&#34;city&#34;</span>: <span style="color:#e6db74">&#34;Melbourne&#34;</span>
    }
}
</code></pre></div>
<div class="notices note" ><p>This would cause the Lambda function to search DynamoDB for all trips that have <strong>Melbourne</strong> as a destination. We need to add a <strong>Mapping Template</strong> for this method in API Gateway to correctly transform the request into this format.</p>
</div>

<ol start="75">
<li>In the <strong>/tripstocity/{city} - GET - Method Execution</strong> panel, click <strong>Integration Request</strong></li>
<li>Scroll down to <strong>Mapping Templates</strong> and open the section by clicking on the triangle to reveal the panel</li>
<li>Select the <strong>When there are no templates defined (recommended) option</strong></li>
<li>Click <strong>Add mapping template</strong></li>
<li>For <strong>Content-Type</strong> type <code>application/json</code> and click the grey tick to commit the change</li>
<li>Scroll further down to show the mapping template entry text field. Paste in the following template:</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
    <span style="color:#f92672">&#34;payload&#34;</span> : {
        <span style="color:#f92672">&#34;city&#34;</span>: <span style="color:#e6db74">&#34;$input.params(&#39;city&#39;)&#34;</span>
    }
}
</code></pre></div><ol start="81">
<li>Click <strong>Save</strong></li>
</ol>
<p>This template will take the parameter <strong>{city}</strong> from the URL and add it into a JSON payload that is sent to the Lambda function, as a property of the <strong>payload</strong> object, just as the Lambda function expects.</p>
<ol start="82">
<li>Test the <strong>/tripstocity</strong> API call to confirm it is functioning as expected.</li>
</ol>
<p><img src="/images/2/20.png?width=90pc" alt="API Gateway"></p>
<ol start="83">
<li>To allow access from a web browser, you need to enable CORS - Cross-origin scripting. Click on the <strong>/tripstocity/{city}</strong> node and from the <strong>Actions</strong> menu, select <strong>Enable CORS</strong>.</li>
<li>Click <strong>Enable CORS and replace existing CORS headers</strong></li>
<li>On the dialog that appears, click <strong>Yes, replace existing values</strong>. When each of the listed items have a green tick against them, you can move on to the next section. This will only take a moment.</li>
</ol>
<p>If you have completed the steps above as described, you will have a resources tree that looks like this:</p>
<p><img src="/images/2/21.png?width=90pc" alt="API Gateway"></p>
<h4 id="deploy-the-api-and-test">Deploy the API and test</h4>
<ol start="86">
<li>Now that you have confirmed that the microservices are functioning correctly, you are ready to deploy the API and test it from the publicly available endpoint. Click the <strong>/</strong> root element of the API and click the <strong>Actions</strong> button.</li>
<li>Select <strong>Deploy API</strong></li>
</ol>
<p><img src="/images/2/22.png?width=90pc" alt="API Gateway"></p>
<ol start="88">
<li>In the <strong>Deploy API</strong> dialog that appears, for <strong>Deployment stage</strong> choose <code>[New Stage]</code> to create a new deployment stage.</li>
<li>For <strong>Stage name</strong> type <code>prod</code></li>
<li>For <strong>Stage description</strong> type <code>Trips API</code></li>
<li>For <strong>Deployment description</strong> type <code>Initial deployment</code></li>
<li>Click <strong>Deploy</strong></li>
</ol>
<p><img src="/images/2/23.png?width=90pc" alt="API Gateway"></p>
<p>The new stage <strong>prod</strong> will be created and you will see the <strong>prod Stage Editor</strong></p>
<p><img src="/images/2/24.png?width=90pc" alt="API Gateway"></p>
<ol start="93">
<li>Click the <strong>Invoke URL</strong> link. A new window will open and hit the stage endpoint. You will see an error message stating <code>{&quot;message&quot;:&quot;Missing Authentication Token&quot;}</code>. This is because there is no handler for the root of the stage - you have only defined resources/methods beneath the <strong>/trips, /tripsfromcity</strong> and <strong>/tripstocity</strong> paths. Edit the URL in the URL bar of the browser and append <strong>/trips</strong> then press <strong>Enter</strong>. The page will refresh, and then display all of the available trips as JSON. The output will be similar to this:</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
	<span style="color:#f92672">&#34;succeeded&#34;</span>: <span style="color:#66d9ef">true</span>,
	<span style="color:#f92672">&#34;message&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>,
	<span style="color:#f92672">&#34;errorCode&#34;</span>: <span style="color:#ae81ff">0</span>,
	<span style="color:#f92672">&#34;data&#34;</span>: [{
		<span style="color:#f92672">&#34;date&#34;</span>: <span style="color:#ae81ff">1511866019000</span>,
		<span style="color:#f92672">&#34;originCity&#34;</span>: <span style="color:#e6db74">&#34;Dallas&#34;</span>,
		<span style="color:#f92672">&#34;destinationCity&#34;</span>: <span style="color:#e6db74">&#34;Santigo de Chile&#34;</span>,
		<span style="color:#f92672">&#34;airline&#34;</span>: <span style="color:#e6db74">&#34;Qantas&#34;</span>
	}, {
		<span style="color:#f92672">&#34;date&#34;</span>: <span style="color:#ae81ff">1514831014000</span>,
		<span style="color:#f92672">&#34;originCity&#34;</span>: <span style="color:#e6db74">&#34;London&#34;</span>,
		<span style="color:#f92672">&#34;destinationCity&#34;</span>: <span style="color:#e6db74">&#34;Melbourne&#34;</span>,
		<span style="color:#f92672">&#34;airline&#34;</span>: <span style="color:#e6db74">&#34;Qantas&#34;</span>
	}]
}
</code></pre></div><ol start="94">
<li>Test the other two methods <strong>/tripsfromcity</strong> and <strong>/tripstocity</strong> in a similar way, but this time, you need to provide the city to search for. For example, use <code>/tripsfromcity/Melbourne</code> to search for all trips that leave from Melbourne.</li>
</ol>
<p>If the data looks right, and there are no errors, you are ready to move on to the next exercise.</p>
<h4 id="exercise-2---use-cloudformationsam-via-the-aws-cli-to-deploy-the-hotelsearch-microservice">Exercise 2 - Use CloudFormation/SAM via the AWS CLI to deploy the HotelSearch microservice</h4>
<p>In the previous steps, you <strong>manually</strong> deployed and configured the <strong>TripSearch</strong> microservice, including the Lambda functions and API Gateway resources. You will have noticed that there are quite a few steps required, and doing this manually is time consuming and prone to errors. In this step, you will use the AWS CLI and CloudFormation/SAM to deploy the <strong>HotelSearch</strong> microservice, instead of manually deploying the resources.</p>
<p>By using CloudFormation/SAM, many of the manual steps will be taken care of for you, streamlining the deployment process. You will still have to manually trigger the process, but the actual deployment will be automated.</p>
<p>The <strong>HotelSpecials</strong> microservice needs to access a MySQL database to retrieve the hotel specials data. The lab environment has automatically deployed and seeded a database for you, and the connection details are provided in <strong>Cloudformation Outputs</strong> tab with instructions below on where to update the placeholder in the template you will use to deploy the microservice. The MySQL instance has been deployed using Amazon RDS and is not publicly-accessible since it is launched in a private subnet. Therefore, for the Lambda function to be able to connect to the database, the Lambda function will also need to be deployed into a private subnet by enabling VPC Integration. The <code>template.yml</code> file provided has all the required setup to do this, you just need to update the placeholders as per the below instructions.</p>
<ol start="95">
<li>The lab setup has created an S3 bucket for you to store the deployment artefact for the Lambda function for the HotelSpecials microservice. First, you need to test and build the deployment package.</li>
</ol>
<p>Download the source code bundle from <a href="https://workshops.devax.academy/monoliths-to-microservices/module6/files/HotelSpecials.zip">HotelSpecials.zip</a> and explode the zip file onto your filesystem.</p>

<section class="attachments ">
	<label>
		<i class="fas fa-paperclip" aria-hidden="true"></i>
		HotelSpecials source code bundle
	</label>
	
		
	
	<div class="attachments-files">
	
		
		
			
				<li>
					<a href="/2-spa/3-api-gateway/_index.files/HotelSpecials.zip" >
						HotelSpecials.zip
					</a>
					(35 ko)
				</li>
			
		
	
	<div>
	
</section>


<ol start="96">
<li>In a terminal window, <code>cd</code> into the filesystem location where you exploded the <strong>HotelSpecials</strong> source code, and build the deployment artefact by issuing the following command:</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">mvn package shade:shade
</code></pre></div><p>The deployment artefact (JAR file) will be built and stored in <code>./target/hotelspecials-1.0.0.jar</code></p>
<ol start="97">
<li>Locate the file <code>template.yml</code> in the <strong>HotelSpecials</strong> source code folder, and open it in a text editor such as Eclipse. <strong>Search/Replace</strong> the following placeholders with the actual values from <strong>Cloudformation Outputs</strong> tab:</li>
</ol>
<ul>
<li>&lt;DatabaseSecurityGroup&gt;</li>
<li>&lt;DatabaseSubnet1&gt;</li>
<li>&lt;DatabaseSubnet2&gt;</li>
<li>&lt;RDSEndpoint&gt;</li>
</ul>
<p>Save the <code>template.yml</code> file once you have made the changes.</p>
<ol start="98">
<li>Use the AWS CLI to package the Lambda function (from the deployment artefact you just built). Run the following command from the commandline:</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">aws cloudformation package --template template.yml --s3-bucket &lt;S3BucketLambdaCode&gt; --output-template template-export.yml
</code></pre></div>
<div class="notices note" ><p>Replace the with the value shown in <strong>Cloudformation Outputs</strong> tab for the key <strong>S3BucketLambdaCodeBucketName</strong>. Do not include the *<em>&lt;</em>* and **&gt;** symbols.</p>
</div>

<p>The command will upload the build artefact to the S3 bucket, and then update the template.yml pointer to the code artefact on S3, and write out a new template with this update included, to a file called <code>template-export.yml</code></p>

<div class="notices tip" ><p>It will take a moment or two for the upload of the artefact to complete.</p>
</div>

<ol start="99">
<li>Use the <strong>AWS CLI</strong> to create and deploy a <strong>CloudFormation Change Set</strong>:</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">aws cloudformation deploy --template-file template-export.yml --stack-name HotelSpecialsAPI --capabilities CAPABILITY_IAM
</code></pre></div><ol start="100">
<li>In the web browser, open the <strong>CloudFormation console</strong>. You should see an output like this:</li>
</ol>
<p><img src="/images/2/25.png?width=90pc" alt="API Gateway"></p>
<p>This indicates that the <strong>CloudFormation Change Set</strong> has been created. The command you issued will create the Change Set and then automatically execute the Change Set, so if you refresh the stack list again, you will see:</p>
<p><img src="/images/2/26.png?width=90pc" alt="API Gateway"></p>
<p>This indicates that the Change Set is being applied to the CloudFormation stack named <strong>HotelSpecialsAPI</strong></p>
<p>It will take a few moments to complete the execution. If you refresh, you will eventually see:</p>
<p><img src="/images/2/27.png?width=90pc" alt="API Gateway"></p>
<ol start="101">
<li>
<p>Click the <strong>HotelSpecialsAPI</strong> stack’s check box to highlight it, click the <strong>Events</strong> tab and review the steps that the CloudFormation template has applied to your environment. These will match the resources and actions in the <code>template-output.yml</code> file.</p>
</li>
<li>
<p>When the Change Set has been executed, your <strong>HotelSpecials API</strong> has been deployed. Open the <strong>API Gateway console</strong> in the browser and under <strong>APIs</strong>, click the <strong>iDevelop - Hotel Specials API</strong> link to reveal the resources for the API:</p>
</li>
</ol>
<p><img src="/images/2/28.png?width=90pc" alt="API Gateway"></p>
<p>Note that a single <strong>GET</strong> method is defined, as per the <code>template.yml</code> CloudFormation template you deployed.</p>
<ol start="103">
<li>Click on the <strong>GET</strong> method beneath <strong>/hotelspecials</strong> to reveal the <strong>/hotelspecials - GET - Method Execution</strong> panel. Click <strong>Integration Request</strong></li>
</ol>
<p><img src="/images/2/29.png?width=90pc" alt="API Gateway"></p>
<ol start="104">
<li>The <strong>Integration Request</strong> panel will be shown. Note the <strong>Lambda Function</strong> specified:</li>
</ol>
<p><img src="/images/2/30.png?width=90pc" alt="API Gateway"></p>
<p>The specified value is not a Lambda function, but instead, is a <strong>Stage Variable</strong> that will be replaced at runtime by API Gateway. Therefore, in order for this API call to succeed, the <strong>Stage</strong> in API Gateway must have defined a value for the <code>envHotelSpecials</code> stage variable.</p>
<p>Click on the <strong>Stages</strong> link beneath the <strong>iDevelop - Hotel Specials API</strong> on the left:</p>
<p><img src="/images/2/31.png?width=90pc" alt="API Gateway"></p>
<ol start="105">
<li>Click on the <strong>prod</strong> stage link</li>
</ol>
<p><img src="/images/2/32.png?width=90pc" alt="API Gateway"></p>
<ol start="106">
<li>In the <strong>prod Stage Editor</strong> click the <strong>Stage Variables</strong> tab</li>
</ol>
<p><img src="/images/2/33.png?width=90pc" alt="API Gateway"></p>

<div class="notices note" ><p>Note that a single variable is defined - <code>envHotelSpecials</code> - which correlates to the stage variable name the <strong>GET</strong> method was expecting. The value of the variable is <strong>GetHotelSpecials</strong> which is the name of the Lambda function that the template created using the JAR file you built and uploaded during the package/deploy process.</p>
</div>

<p>Using stage variables gives you a level of indirection at runtime, and also when designing your CloudFormation/SAM templates. You can update the value of a stage variable at any time without having to re-deploy the API.</p>
<h4 id="test-the-hotelspecials-api">Test the HotelSpecials API</h4>
<p>You are now ready to test the HotelSpecials API.</p>
<ol start="107">
<li>Expand the <strong>prod</strong> root element in the <strong>Stages</strong> list to reveal the hierarchy.</li>
<li>Click on the <strong>GET</strong> method</li>
<li>Click on the <strong>Invoke URL</strong> value in the <strong>prod - GET - /hotelspecials</strong> panel. After a moment while the Lambda function is initialised, you should see the JSON result of querying the mySQL database from the Lambda function.</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
	<span style="color:#f92672">&#34;succeeded&#34;</span>: <span style="color:#66d9ef">true</span>,
	<span style="color:#f92672">&#34;message&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>,
	<span style="color:#f92672">&#34;errorCode&#34;</span>: <span style="color:#ae81ff">0</span>,
	<span style="color:#f92672">&#34;data&#34;</span>: [{
		<span style="color:#f92672">&#34;hotel&#34;</span>: <span style="color:#e6db74">&#34;Sommerset Hotel&#34;</span>,
		<span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Minimum stay 3 nights&#34;</span>,
		<span style="color:#f92672">&#34;cost&#34;</span>: <span style="color:#ae81ff">474</span>,
		<span style="color:#f92672">&#34;expiryDate&#34;</span>: <span style="color:#ae81ff">1504064184038</span>,
		<span style="color:#f92672">&#34;location&#34;</span>: <span style="color:#e6db74">&#34;Sydney&#34;</span>,
		<span style="color:#f92672">&#34;id&#34;</span>: <span style="color:#ae81ff">1</span>
	}, {
		<span style="color:#f92672">&#34;hotel&#34;</span>: <span style="color:#e6db74">&#34;Freedmom Apartments&#34;</span>,
		<span style="color:#f92672">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;Pets allowed!&#34;</span>,
		<span style="color:#f92672">&#34;cost&#34;</span>: <span style="color:#ae81ff">501</span>,
		<span style="color:#f92672">&#34;expiryDate&#34;</span>: <span style="color:#ae81ff">1504068564781</span>,
		<span style="color:#f92672">&#34;location&#34;</span>: <span style="color:#e6db74">&#34;Sydney&#34;</span>,
		<span style="color:#f92672">&#34;id&#34;</span>: <span style="color:#ae81ff">2</span>
	}]
}
</code></pre></div><p>If you see a JSON payload with no errors, you have successfully deployed an API and supporting Lambda function that queries the mySQL database.</p>
<p>Notice how much quicker and easier that was to deploy without any manual intervention?</p>
<p>That is the power of automation. In the next exercise, we will take this one step further, using the (now familiar) CI/CD pipeline approach to deploy our next API.</p>





<footer class=" footline" >
	
</footer>

        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="/2-spa/2-build-deploy/" title="Serverless Microservices"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/2-spa/4-codestar-cicd/" title="Deploy the API using CodeStar and CI/CD" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1622779992"></script>
    <script src="/js/perfect-scrollbar.min.js?1622779992"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1622779992"></script>
    <script src="/js/jquery.sticky.js?1622779992"></script>
    <script src="/js/featherlight.min.js?1622779992"></script>
    <script src="/js/highlight.pack.js?1622779992"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom-3.6.0.js?1622779992"></script>
    <script src="/js/learn.js?1622779992"></script>
    <script src="/js/hugo-learn.js?1622779992"></script>

    <link href="/mermaid/mermaid.css?1622779992" rel="stylesheet" />
    <script src="/mermaid/mermaid.js?1622779992"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-158079754-2', 'auto');
  ga('send', 'pageview');

</script>
  </body>
</html>
