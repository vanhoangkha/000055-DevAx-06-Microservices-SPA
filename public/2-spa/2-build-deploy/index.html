<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.69.0" />
    <meta name="description" content="">
<meta name="author" content="journeyoftheaverageguy@gmail.com">

    <link rel="icon" href="/images/favicon.png" type="image/png">

    <title>Serverless Microservices :: DevAx - Monoliths to Microservices - Creating an Authenticated Single Page Application (SPA)</title>

    
    <link href="/css/nucleus.css?1622738044" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css?1622738044" rel="stylesheet">
    <link href="/css/hybrid.css?1622738044" rel="stylesheet">
    <link href="/css/featherlight.min.css?1622738044" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1622738044" rel="stylesheet">
    <link href="/css/auto-complete.css?1622738044" rel="stylesheet">
    <link href="/css/atom-one-dark-reasonable.css?1622738044" rel="stylesheet">
    <link href="/css/theme.css?1622738044" rel="stylesheet">
    <link href="/css/hugo-theme.css?1622738044" rel="stylesheet">
    
    <link href="/css/theme-workshop.css?1622738044" rel="stylesheet">
    
    

    <script src="/js/jquery-3.3.1.min.js?1622738044"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="/2-spa/2-build-deploy/">
    <nav id="sidebar" class="showVisitedLinks">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="/">

<svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30" width="30%"><defs><style>.cls-1{fill:#fff;}.cls-2{fill:#f90;fill-rule:evenodd;}</style></defs><title>AWS-Logo_White-Color</title><path class="cls-1" d="M14.09,10.85a4.7,4.7,0,0,0,.19,1.48,7.73,7.73,0,0,0,.54,1.19.77.77,0,0,1,.12.38.64.64,0,0,1-.32.49l-1,.7a.83.83,0,0,1-.44.15.69.69,0,0,1-.49-.23,3.8,3.8,0,0,1-.6-.77q-.25-.42-.51-1a6.14,6.14,0,0,1-4.89,2.3,4.54,4.54,0,0,1-3.32-1.19,4.27,4.27,0,0,1-1.22-3.2A4.28,4.28,0,0,1,3.61,7.75,6.06,6.06,0,0,1,7.69,6.46a12.47,12.47,0,0,1,1.76.13q.92.13,1.91.36V5.73a3.65,3.65,0,0,0-.79-2.66A3.81,3.81,0,0,0,7.86,2.3a7.71,7.71,0,0,0-1.79.22,12.78,12.78,0,0,0-1.79.57,4.55,4.55,0,0,1-.58.22l-.26,0q-.35,0-.35-.52V2a1.09,1.09,0,0,1,.12-.58,1.2,1.2,0,0,1,.47-.35A10.88,10.88,0,0,1,5.77.32,10.19,10.19,0,0,1,8.36,0a6,6,0,0,1,4.35,1.35,5.49,5.49,0,0,1,1.38,4.09ZM7.34,13.38a5.36,5.36,0,0,0,1.72-.31A3.63,3.63,0,0,0,10.63,12,2.62,2.62,0,0,0,11.19,11a5.63,5.63,0,0,0,.16-1.44v-.7a14.35,14.35,0,0,0-1.53-.28,12.37,12.37,0,0,0-1.56-.1,3.84,3.84,0,0,0-2.47.67A2.34,2.34,0,0,0,5,11a2.35,2.35,0,0,0,.61,1.76A2.4,2.4,0,0,0,7.34,13.38Zm13.35,1.8a1,1,0,0,1-.64-.16,1.3,1.3,0,0,1-.35-.65L15.81,1.51a3,3,0,0,1-.15-.67.36.36,0,0,1,.41-.41H17.7a1,1,0,0,1,.65.16,1.4,1.4,0,0,1,.33.65l2.79,11,2.59-11A1.17,1.17,0,0,1,24.39.6a1.1,1.1,0,0,1,.67-.16H26.4a1.1,1.1,0,0,1,.67.16,1.17,1.17,0,0,1,.32.65L30,12.39,32.88,1.25A1.39,1.39,0,0,1,33.22.6a1,1,0,0,1,.65-.16h1.54a.36.36,0,0,1,.41.41,1.36,1.36,0,0,1,0,.26,3.64,3.64,0,0,1-.12.41l-4,12.86a1.3,1.3,0,0,1-.35.65,1,1,0,0,1-.64.16H29.25a1,1,0,0,1-.67-.17,1.26,1.26,0,0,1-.32-.67L25.67,3.64,23.11,14.34a1.26,1.26,0,0,1-.32.67,1,1,0,0,1-.67.17Zm21.36.44a11.28,11.28,0,0,1-2.56-.29,7.44,7.44,0,0,1-1.92-.67,1,1,0,0,1-.61-.93v-.84q0-.52.38-.52a.9.9,0,0,1,.31.06l.42.17a8.77,8.77,0,0,0,1.83.58,9.78,9.78,0,0,0,2,.2,4.48,4.48,0,0,0,2.43-.55,1.76,1.76,0,0,0,.86-1.57,1.61,1.61,0,0,0-.45-1.16A4.29,4.29,0,0,0,43,9.22l-2.41-.76A5.15,5.15,0,0,1,38,6.78a3.94,3.94,0,0,1-.83-2.41,3.7,3.7,0,0,1,.45-1.85,4.47,4.47,0,0,1,1.19-1.37A5.27,5.27,0,0,1,40.51.29,7.4,7.4,0,0,1,42.6,0a8.87,8.87,0,0,1,1.12.07q.57.07,1.08.19t.95.26a4.27,4.27,0,0,1,.7.29,1.59,1.59,0,0,1,.49.41.94.94,0,0,1,.15.55v.79q0,.52-.38.52a1.76,1.76,0,0,1-.64-.2,7.74,7.74,0,0,0-3.2-.64,4.37,4.37,0,0,0-2.21.47,1.6,1.6,0,0,0-.79,1.48,1.58,1.58,0,0,0,.49,1.18,4.94,4.94,0,0,0,1.83.92L44.55,7a5.08,5.08,0,0,1,2.57,1.6A3.76,3.76,0,0,1,47.9,11a4.21,4.21,0,0,1-.44,1.93,4.4,4.4,0,0,1-1.21,1.47,5.43,5.43,0,0,1-1.85.93A8.25,8.25,0,0,1,42.05,15.62Z"></path><path class="cls-2" d="M45.19,23.81C39.72,27.85,31.78,30,25,30A36.64,36.64,0,0,1,.22,20.57c-.51-.46-.06-1.09.56-.74A49.78,49.78,0,0,0,25.53,26.4,49.23,49.23,0,0,0,44.4,22.53C45.32,22.14,46.1,23.14,45.19,23.81Z"></path><path class="cls-2" d="M47.47,21.21c-.7-.9-4.63-.42-6.39-.21-.53.06-.62-.4-.14-.74,3.13-2.2,8.27-1.57,8.86-.83s-.16,5.89-3.09,8.35c-.45.38-.88.18-.68-.32C46.69,25.8,48.17,22.11,47.47,21.21Z"></path></svg>

</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/js/lunr.min.js?1622738044"></script>
<script type="text/javascript" src="/js/auto-complete.js?1622738044"></script>
<script type="text/javascript">
    
        var baseurl = "";
    
</script>
<script type="text/javascript" src="/js/search.js?1622738044"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/1-prerequisites/" title="Prerequisites" class="dd-item 
        
        
        
        ">
      <a href="/1-prerequisites/">
          <b>1. </b>Prerequisites
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/1-prerequisites/1-create-environment/" title="Create Environment" class="dd-item 
        
        
        
        ">
      <a href="/1-prerequisites/1-create-environment/">
          <b>1.1. </b>Create Environment
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/1-prerequisites/1-create-environment/1-vpc/" title="VPC" class="dd-item 
        
        
        
        ">
      <a href="/1-prerequisites/1-create-environment/1-vpc/">
          <b>1.1.1. </b>VPC
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/1-prerequisites/1-create-environment/2-ec2/" title="EC2" class="dd-item 
        
        
        
        ">
      <a href="/1-prerequisites/1-create-environment/2-ec2/">
          <b>1.1.2. </b>EC2
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/1-prerequisites/1-create-environment/3-rds/" title="RDS" class="dd-item 
        
        
        
        ">
      <a href="/1-prerequisites/1-create-environment/3-rds/">
          <b>1.1.3. </b>RDS
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/1-prerequisites/2-remote-env-config-cli/" title="Remote enviroment &amp; Configure the AWS CLI" class="dd-item 
        
        
        
        ">
      <a href="/1-prerequisites/2-remote-env-config-cli/">
          <b>1.2. </b>Remote enviroment &amp; Configure the AWS CLI
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/2-spa/" title="Single Page Application" class="dd-item 
        parent
        
        
        ">
      <a href="/2-spa/">
          <b>2. </b>Single Page Application
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/2-spa/1-prerequisites/" title="Pre-requisites" class="dd-item 
        
        
        
        ">
      <a href="/2-spa/1-prerequisites/">
          <b>2.1. </b>Pre-requisites
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/2-spa/1-prerequisites/a/" title="Eclipse Environment" class="dd-item 
        
        
        
        ">
      <a href="/2-spa/1-prerequisites/a/">
          <b>Option A. </b>Eclipse Environment
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/2-spa/1-prerequisites/b/" title="AWS Cloud9 Environment" class="dd-item 
        
        
        
        ">
      <a href="/2-spa/1-prerequisites/b/">
          <b>Option B. </b>AWS Cloud9 Environment
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/2-spa/2-build-deploy/" title="Serverless Microservices" class="dd-item 
        
        active
        
        ">
      <a href="/2-spa/2-build-deploy/">
          <b>2.2. </b>Serverless Microservices
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/2-spa/3-api-gateway/" title="Create and Expose the API" class="dd-item 
        
        
        
        ">
      <a href="/2-spa/3-api-gateway/">
          <b>2.3. </b>Create and Expose the API
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/2-spa/4-codestar-cicd/" title="Deploy the API using CodeStar and CI/CD" class="dd-item 
        
        
        
        ">
      <a href="/2-spa/4-codestar-cicd/">
          <b>2.4. </b>Deploy the API using CodeStar and CI/CD
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/2-spa/4-codestar-cicd/a/" title="Eclipse Environment" class="dd-item 
        
        
        
        ">
      <a href="/2-spa/4-codestar-cicd/a/">
          <b>Option A. </b>Eclipse Environment
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/2-spa/4-codestar-cicd/b/" title="AWS Cloud9 Environment" class="dd-item 
        
        
        
        ">
      <a href="/2-spa/4-codestar-cicd/b/">
          <b>Option B. </b>AWS Cloud9 Environment
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/2-spa/5-setup-spa/" title="Setup the SPA Webpage" class="dd-item 
        
        
        
        ">
      <a href="/2-spa/5-setup-spa/">
          <b>2.5. </b>Setup the SPA Webpage
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/2-spa/6-consume-api/" title="Consume the API" class="dd-item 
        
        
        
        ">
      <a href="/2-spa/6-consume-api/">
          <b>2.6. </b>Consume the API
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/3-aaa/" title="Configure AAA" class="dd-item 
        
        
        
        ">
      <a href="/3-aaa/">
          <b>3. </b>Configure AAA
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/3-aaa/1-cognito/" title="SPA Authentication" class="dd-item 
        
        
        
        ">
      <a href="/3-aaa/1-cognito/">
          <b>3.1. </b>SPA Authentication
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/3-aaa/2-microservice-authen/" title="Microservice Authentication" class="dd-item 
        
        
        
        ">
      <a href="/3-aaa/2-microservice-authen/">
          <b>3.2. </b>Microservice Authentication
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/3-aaa/3-deploy-test/" title="Deploy and Test" class="dd-item 
        
        
        
        ">
      <a href="/3-aaa/3-deploy-test/">
          <b>3.3. </b>Deploy and Test
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/3-aaa/4-signup-signin/" title="User Sign Up/Sign In" class="dd-item 
        
        
        
        ">
      <a href="/3-aaa/4-signup-signin/">
          <b>3.4. </b>User Sign Up/Sign In
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/4-xray/" title="Application Performance" class="dd-item 
        
        
        
        ">
      <a href="/4-xray/">
          <b>4. </b>Application Performance
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/5-challenge/" title="Challenge" class="dd-item 
        
        
        
        ">
      <a href="/5-challenge/">
          <b>5. </b>Challenge
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/6-conclusion/" title="Conclusion" class="dd-item 
        
        
        
        ">
      <a href="/6-conclusion/">
          <b>6. </b>Conclusion
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/7-resources/" title="Reference resources" class="dd-item 
        
        
        
        ">
      <a href="/7-resources/">
          <b>7. </b>Reference resources
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
         
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li> 
                  <a class="padding" href="http://awsstudygroup.com"><i class='fab fa-aws'></i> AWS Study Group - Blog</a>
              </li>
          
              <li> 
                  <a class="padding" href="https://www.facebook.com/groups/660548818043427/"><i class='fab fa-facebook'></i> AWS Study Group - FB Group</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="prefooter">
      <hr/>
      <ul>
      
        <li>
          <a class="padding">
            <i class="fas fa-language fa-fw"></i>
          <div class="select-style">
            <select id="select-language" onchange="location = this.value;">
          
          
          
              
              
                  
                    
                    
                      <option id="en" value="/2-spa/2-build-deploy/" selected>English</option>
                    
                  
              
                  
              
          
              
              
                  
              
                  
                    
                    
                      <option id="vi" value="/vi/2-spa/2-build-deploy/">Tiếng Việt</option>
                    
                  
              
          
        </select>
        <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
          width="255px" height="255px" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255;" xml:space="preserve">
          <g>
            <g id="arrow-drop-down">
              <polygon points="0,63.75 127.5,191.25 255,63.75 		" />
            </g>
          </g>
        </svg>
        </div>
        </a>
        </li>
      
      
      
        <li><a class="padding" href="#" data-clear-history-toggle=""><i class="fas fa-history fa-fw"></i> Clear History</a></li>
      
      </ul>
    </section>
    
    <section id="footer">
      <left>
    
    

    

    
</left>

<script async defer src="https://buttons.github.io/buttons.js"></script>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='/'>Creating an Authenticated Single Page Application (SPA)</a> > <a href='/2-spa/'>Single Page Application</a> > Serverless Microservices
          
        
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Serverless Microservices
            </h1>
          

        



	<p><strong>Manually Build and Deploy a Serverless Microservice</strong></p>
<p>In this exercise, you will manually create and configure a serverless microservice. As you progress through this lab, you will use other techniques for build and deployment, so that you can compare and contrast the efficiencies of each approach and how automation makes the development experience more agile and increases developer efficiency.</p>
<p>You will create the TripSearch microservice manually. The TripSearch microservice exposes the following functions:</p>
<blockquote>
<ul>
<li><strong>/trips</strong> - returns a list of all available trips in the system</li>
<li><strong>/tripsfromcity</strong> - returns a list of all trips that originate from a given city</li>
<li><strong>/tripstocity</strong> - returns a list of all trips that have the given city as a destination</li>
</ul>
</blockquote>
<p>This is the same microservice we looked at in a previous lab. But this time, we will expose this functionality in our TravelBuddy website, and so need to deploy the service to be available to the website. Previously, the API Gateway configuration was taken care of for you by the deployment pipeline - in this exercise, you will manually configure the setup of both the Lambda function and the API Gateway.</p>
<p><strong>Contents</strong></p>
<ul>
<li><a href="#download-source-code-and-build-the-deployment-artefact">Download source code and build the deployment artefact</a></li>
<li><a href="#why-am-i-seeing-the-message-aws-x-ray-unavailable---ignoring-in-the-output">Why am I seeing the message <strong>AWS X-ray unavailable - ignoring</strong> in the output?</a></li>
<li><a href="#create-two-new-lambda-functions-using-the-same-deployment-artefact">Create two new Lambda functions using the same deployment artefact</a></li>
</ul>
<h4 id="download-source-code-and-build-the-deployment-artefact">Download source code and build the deployment artefact</h4>
<ol>
<li>The lab setup has created an <strong>S3 bucket</strong> for you to store the <strong>deployment artefact</strong> for the Lambda function for the <strong>TripSearch microservice</strong>. First, you need to test and build the deployment package.<br>
Download the source code bundle from <a href="https://workshops.devax.academy/monoliths-to-microservices/module6/files/TripSearchFull.zip">TripSearchFull.zip</a> and explode the zip file onto your filesystem. You can do this in your own operating system, the windows system or cloud9 as your options. The following command will download the bundle for you:</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">curl -L http://workshops.devax.academy/monoliths-to-microservices/module6/files/TripSearchFull.zip --output TripSearchFull.zip
</code></pre></div><p>Or download below:</p>

<section class="attachments ">
	<label>
		<i class="fas fa-paperclip" aria-hidden="true"></i>
		Source code bundle
	</label>
	
		
	
	<div class="attachments-files">
	
		
		
			
				<li>
					<a href="/2-spa/2-build-deploy/_index.files/TripSearchFull.zip" >
						TripSearchFull.zip
					</a>
					(21 ko)
				</li>
			
		
	
	<div>
	
</section>


<ol start="2">
<li><code>cd</code> into the filesystem location where you exploded the <strong>TripSearchFull</strong> source code, and run the unit test by issuing one of the following commands:</li>
</ol>
<p><strong>For MacOS:</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">export DDB_TABLENAME_TRIPSECTOR<span style="color:#f92672">=</span>TravelBuddyTripSectors; mvn test
</code></pre></div><p><strong>For Windows:</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">set DDB_TABLENAME_TRIPSECTOR<span style="color:#f92672">=</span>TravelBuddyTripSectors
mvn test
</code></pre></div><p><strong>For Cloud9 - if not already setup:</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">set DDB_TAB
sudo yum install -y java-1.8.0-openjdk-devel
sudo alternatives --config java <span style="color:#75715e">#enter 1.8 version #enter 2</span>
sudo alternatives --config javac <span style="color:#75715e">#enter 1.8 version #enter 2</span>
sudo yum remove -y java-1.7.0-openjdk-devel
sudo wget http://repos.fedorapeople.org/repos/dchen/apache-maven/epel-apache-maven.repo -O /etc/yum.repos.d/epel-apache-maven.repo
sudo sed -i s/<span style="color:#ae81ff">\$</span>releasever/6/g /etc/yum.repos.d/epel-apache-maven.repo
sudo yum install -y apache-maven
</code></pre></div><p><strong>Run test for Cloud9:</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">export DDB_TABLENAME_TRIPSECTOR<span style="color:#f92672">=</span>TravelBuddyTripSectors; mvn test
</code></pre></div>
<div class="notices tip" ><p>If the tests <strong>fail</strong>, First try to export you profile as the default profile e.g. <strong>On Windows:</strong> <code>set AWS_PROFILE=devaxacademy</code> | <strong>On Mac:</strong> <code>export AWS_PROFILE=devaxacademy</code></p>
</div>


<div class="notices tip" ><p>If the tests continue to <strong>fail</strong>, it may be because the lab environment hasn’t yet finished creating. Check that the Lab is <strong>fully running</strong> before continuing.</p>
</div>


<div class="notices tip" ><p>If the tests <strong>fail</strong> and the first error message is <strong>&ldquo;Unable to load AWS credentials from any provider in the chain&rdquo;</strong>. Make sure to set your <strong>AWS CLI credentials</strong>.</p>
</div>

<p>This command sets the table name for the DynamoDB table to match the name of the table set by the lab setup. You will see output like the following:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">2021-03-30 18:03:55 &lt;&gt; WARN  BasicProfileConfigLoader:96 - The legacy profile format requires the <span style="color:#e6db74">&#39;profile &#39;</span> prefix before the profile name. The latest code does not require
 such prefix, and will consider it as part of the profile name. Please remove the prefix <span style="color:#66d9ef">if</span> you are seeing this warning.
EnvVar DDB_TABLENAME_TRIPSECTOR detected - overriding DDB TableName to TravelBuddyTripSectors
AWS X-ray unavailable - ignoring
Found <span style="color:#ae81ff">52</span> total trips.
Sun Jun <span style="color:#ae81ff">20</span> 23:52:23 UTC <span style="color:#ae81ff">2021</span> &gt; Melbourne to Geelong on Qantas
Tue Jun <span style="color:#ae81ff">15</span> 02:12:51 UTC <span style="color:#ae81ff">2021</span> &gt; Geelong to Brisbane on Qantas
Tue Aug <span style="color:#ae81ff">17</span> 20:29:29 UTC <span style="color:#ae81ff">2021</span> &gt; Melbourne to Cairo on Qantas
Sat Mar <span style="color:#ae81ff">12</span> 23:18:51 UTC <span style="color:#ae81ff">2022</span> &gt; Sydney to Singapore on Qantas
Thu May <span style="color:#ae81ff">27</span> 02:55:51 UTC <span style="color:#ae81ff">2021</span> &gt; Perth to Hobart on Qantas
.....&lt;omitted&gt;
Starting devlounge.lambda.FindTripsFromCityHandler Lambda with input Melbourne

AWS X-ray unavailable - ignoring
Found <span style="color:#ae81ff">8</span> total trips.

Sun Jun <span style="color:#ae81ff">20</span> 23:52:23 UTC <span style="color:#ae81ff">2021</span> &gt; Melbourne to Geelong on Qantas
Tue Aug <span style="color:#ae81ff">17</span> 20:29:29 UTC <span style="color:#ae81ff">2021</span> &gt; Melbourne to Cairo on Qantas
Tue Jun <span style="color:#ae81ff">08</span> 04:55:44 UTC <span style="color:#ae81ff">2021</span> &gt; Melbourne to Dallas on Qantas
Thu Dec <span style="color:#ae81ff">09</span> 22:15:45 UTC <span style="color:#ae81ff">2021</span> &gt; Melbourne to Singapore on Qantas
Tue Jun <span style="color:#ae81ff">15</span> 06:55:59 UTC <span style="color:#ae81ff">2021</span> &gt; Melbourne to Broome on Qantas
Sun Dec <span style="color:#ae81ff">19</span> 18:06:06 UTC <span style="color:#ae81ff">2021</span> &gt; Melbourne to Geelong on Qantas
Fri Apr <span style="color:#ae81ff">09</span> 05:45:41 UTC <span style="color:#ae81ff">2021</span> &gt; Melbourne to Newcastle on Qantas
Sun Apr <span style="color:#ae81ff">03</span> 15:19:34 UTC <span style="color:#ae81ff">2022</span> &gt; Melbourne to Sydney on Qantas
Starting devlounge.lambda.FindTripsToCityHandler Lambda with city Sydney

AWS X-ray unavailable - ignoring
Found <span style="color:#ae81ff">2</span> total trips.

Mon Feb <span style="color:#ae81ff">28</span> 19:39:13 UTC <span style="color:#ae81ff">2022</span> &gt; Perth to Sydney on Qantas
Sun Apr <span style="color:#ae81ff">03</span> 15:19:34 UTC <span style="color:#ae81ff">2022</span> &gt; Melbourne to Sydney on Qantas
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 2.111 sec

Results :

Tests run: 1, Failures: 0, Errors: 0, Skipped: 0
</code></pre></div>
<div class="notices note" ><p>Note that the from and to city examples shown here, and the dates and times, will be different for your environment because they have been randomly generated.</p>
</div>


<div class="notices info" ><p>You should see no errors emitted by the unit test, which confirms the source code is building and running as expected. If you see an error, investigate.</p>
</div>

<h4 id="why-am-i-seeing-the-message-aws-x-ray-unavailable---ignoring-in-the-output">Why am I seeing the message <strong>AWS X-ray unavailable - ignoring</strong> in the output?</h4>
<p>When you run the tests on your local development environment, the AWS X-ray agent is not available, and so the calls through the AWS SDK cannot be recorded with AWS X-ray. However, since the <code>pom.xml</code> file defines a dependency to the AWS X-ray recorder, all calls through the SDK (for example, to DynamoDB) are attempted to be recorded. This would normally cause an error, and the tests would fail.</p>
<p>Notice that each of the Lambda handler classes extend a base class called <strong>LambdaHandlerWithXRayBase</strong>? In this class, there is a static initializer, and it builds <strong>ContextMissingStrategy object</strong>, overrides the behaviour for when there is no AWS X-ray context, and sets this as the default behaviour. In the implementation of the <strong>contextMissing handler</strong>, we simply print a message to the console, rather than the default action, which is to throw an exception. The implementation of the <strong>LambdaHandlerWithXRayBase class</strong> looks like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">LambdaHandlerWithXRayBase</span> 
<span style="color:#f92672">{</span>
	<span style="color:#66d9ef">static</span>  
	<span style="color:#f92672">{</span>
	  AWSXRayRecorderBuilder builder <span style="color:#f92672">=</span> AWSXRayRecorderBuilder<span style="color:#f92672">.</span><span style="color:#a6e22e">standard</span><span style="color:#f92672">();</span>

	  builder<span style="color:#f92672">.</span><span style="color:#a6e22e">withContextMissingStrategy</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> ContextMissingStrategy<span style="color:#f92672">()</span> 
	  <span style="color:#f92672">{</span>		
		<span style="color:#a6e22e">@Override</span>
		<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">contextMissing</span><span style="color:#f92672">(</span>String arg0<span style="color:#f92672">,</span> Class<span style="color:#f92672">&lt;?</span> <span style="color:#66d9ef">extends</span> RuntimeException<span style="color:#f92672">&gt;</span> arg1<span style="color:#f92672">)</span> 
		<span style="color:#f92672">{</span> 
			System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;AWS X-ray unavailable - ignoring&#34;</span><span style="color:#f92672">);</span> 
		<span style="color:#f92672">}</span>	  
	  <span style="color:#f92672">});</span>

	  AWSXRay<span style="color:#f92672">.</span><span style="color:#a6e22e">setGlobalRecorder</span><span style="color:#f92672">(</span>builder<span style="color:#f92672">.</span><span style="color:#a6e22e">build</span><span style="color:#f92672">());</span>
	<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>As an optional experiment, you could try removing the static initializer from the <strong>LambdaHandlerWithXRayBase base class</strong>, and re-running the Maven build. You will see errors such as:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">com.amazonaws.xray.exceptions.SegmentNotFoundException: Thread failed to begin a subsegment: segment not found. Verify that a segment is in progress, and that the SegmentContextResolverChain is configured correctly in order to discover the segment.
</code></pre></div><p>Without the agent being present, and the call to the Lambda function having the correct correlation Id context passed to it, the <strong>SegmentContextResolverChain</strong> cannot determine the AWS X-ray segment to attach the recorded metadata to, and throws an exception. The implementation we provide in the base class overrides this behaviour, to safely ignore this condition while testing on your development environment.</p>
<ol start="3">
<li>If the unit test run is succeeding, you are ready to build the deployment artefact. From the command line, issue the following:</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">mvn package shade:shade
</code></pre></div><ol start="4">
<li>The deployment artefact (JAR file) will be built and stored in <code>./target/tripsearch-1.0.0.jar</code></li>
</ol>
<p>In order to create an AWS Lambda function from this JAR file, you need to push the build artefact up to the <strong>S3BucketLambdaCode S3 bucket</strong> that is accessible by the AWS Lambda environment in the <strong>same region</strong> the Lambda function will be created in. Execute the following command after replacing the relevant parameters noted below:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">aws s3 cp target/tripsearch-1.0.0.jar s3://&lt;S3BucketLambdaCode&gt; --region ap-northeast-1
</code></pre></div><p>Replace the with the value shown in <strong>Cloudformation Outputs</strong> tab for the key <strong>S3BucketLambdaCodeBucketName</strong>. <strong>Do not</strong> include the *<em>&lt;</em>* and **&gt;** symbols.</p>
<ol start="5">
<li>Create a new Lambda function from this deployment artefact, by issuing the following command after replacing the relevant parameters noted below:</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">aws lambda create-function --function-name idevelopTripSearchFull --runtime java8 --role &lt;LambdaRole&gt; --handler devlounge.lambda.FindAllTripsHandler --code S3Bucket<span style="color:#f92672">=</span>&lt;S3BucketLambdaCode&gt;,S3Key<span style="color:#f92672">=</span>tripsearch-1.0.0.jar --timeout <span style="color:#ae81ff">15</span> --description <span style="color:#e6db74">&#34;TravelBuddy TripSearch microservice - FindAllTrips&#34;</span> --memory-size <span style="color:#ae81ff">1024</span> --region ap-northeast-1
</code></pre></div><p>Replace the with the value shown in <strong>Cloudformation Outputs</strong> tab for the key <strong>S3BucketLambdaCodeBucketName</strong>. Replace the with the value shown in <strong>Cloudformation Outputs</strong> tab for the key <strong>LambdaRoleARN</strong>.</p>
<p><strong>Do not</strong> include the <strong>&lt;</strong> and <strong>&gt;</strong> symbols.</p>
<p>If successful, your new Lambda function will be created and you will see an output similar to the following:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">{</span>
    <span style="color:#e6db74">&#34;FunctionName&#34;</span>: <span style="color:#e6db74">&#34;idevelopTripSearchFull&#34;</span>,
    <span style="color:#e6db74">&#34;FunctionArn&#34;</span>: <span style="color:#e6db74">&#34;arn:aws:lambda:ap-northeast-1:XXXXXXXXXXXX:function:idevelopTripSearchFull&#34;</span>,
    <span style="color:#e6db74">&#34;Runtime&#34;</span>: <span style="color:#e6db74">&#34;java8&#34;</span>,
    <span style="color:#e6db74">&#34;Role&#34;</span>: <span style="color:#e6db74">&#34;arn:aws:iam::XXXXXXXXXXXX:role/LambdaRole&#34;</span>,
    <span style="color:#e6db74">&#34;Handler&#34;</span>: <span style="color:#e6db74">&#34;devlounge.lambda.FindAllTripsHandler&#34;</span>,
    <span style="color:#e6db74">&#34;CodeSize&#34;</span>: 9737054,
    <span style="color:#e6db74">&#34;Description&#34;</span>: <span style="color:#e6db74">&#34;TravelBuddy TripSearch microservice - FindAllTrips&#34;</span>,
    <span style="color:#e6db74">&#34;Timeout&#34;</span>: 15,
    <span style="color:#e6db74">&#34;MemorySize&#34;</span>: 1024,
    <span style="color:#e6db74">&#34;LastModified&#34;</span>: <span style="color:#e6db74">&#34;2021-03-30T18:10:38.011+0000&#34;</span>,
    <span style="color:#e6db74">&#34;CodeSha256&#34;</span>: <span style="color:#e6db74">&#34;EGhfTqT/kThg05Ibn8ivLWcKSabLZtIh/t3brnmvyHA=&#34;</span>,
    <span style="color:#e6db74">&#34;Version&#34;</span>: <span style="color:#e6db74">&#34;</span>$LATEST<span style="color:#e6db74">&#34;</span>,
    <span style="color:#e6db74">&#34;TracingConfig&#34;</span>: <span style="color:#f92672">{</span>
        <span style="color:#e6db74">&#34;Mode&#34;</span>: <span style="color:#e6db74">&#34;PassThrough&#34;</span>
    <span style="color:#f92672">}</span>,
    <span style="color:#e6db74">&#34;RevisionId&#34;</span>: <span style="color:#e6db74">&#34;4fdee380-f0ce-4e1e-ab1e-d42e74e89308&#34;</span>,
    <span style="color:#e6db74">&#34;State&#34;</span>: <span style="color:#e6db74">&#34;Active&#34;</span>,
    <span style="color:#e6db74">&#34;LastUpdateStatus&#34;</span>: <span style="color:#e6db74">&#34;Successful&#34;</span>,
    <span style="color:#e6db74">&#34;PackageType&#34;</span>: <span style="color:#e6db74">&#34;Zip&#34;</span>
<span style="color:#f92672">}</span>
</code></pre></div><h4 id="create-two-new-lambda-functions-using-the-same-deployment-artefact">Create two new Lambda functions using the same deployment artefact</h4>
<p>The code that implements our TripSearch function has three handlers exposed - one for finding all trips; one for finding trips that originate from a given city; and one for finding trips that have a given city as the destination. We have exposed only one handler so far - the search for all trips. In this section, we will create two new Lambda functions, each exposing one of the two remaining handlers.</p>
<ol start="6">
<li>Create a new Lambda function from the same deployment artefact we previously uploaded. We can create different Lambda functions from the same artefact because the artefact exports multiple Lambda handlers. In the step above, we exposed <strong>devlounge.lambda.FindAllTripsHandler</strong>. In this step we expose <strong>devlounge.lambda.FindTripsFromCityHandler</strong>. We simply need to issue the same command as above, but change the handler we are exposing and give the Lambda function a unique name.</li>
</ol>
<p>Issue the following command after replacing the relevant parameters noted below:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">aws lambda create-function --function-name idevelopTripSearchFromCity --runtime java8 --role &lt;LambdaRole&gt; --handler devlounge.lambda.FindTripsFromCityHandler --code S3Bucket<span style="color:#f92672">=</span>&lt;S3BucketLambdaCode&gt;,S3Key<span style="color:#f92672">=</span>tripsearch-1.0.0.jar --timeout <span style="color:#ae81ff">15</span> --description <span style="color:#e6db74">&#34;TravelBuddy TripSearch microservice - FindTripsFromCity&#34;</span> --memory-size <span style="color:#ae81ff">1024</span> --region ap-northeast-1
</code></pre></div><p>Replace the with the value shown in <strong>Cloudformation Outputs</strong> tab for the key <strong>S3BucketLambdaCodeBucketName</strong>. Replace the with the value shown in <strong>Cloudformation Outputs</strong> tab for the key <strong>LambdaRoleARN</strong>.</p>
<p>Confirm that you receive a success response similar to the response when you successfully created the first Lambda function.</p>
<ol start="7">
<li>Create the last Lambda function from the same deployment artefact, this time for <strong>FindTripsToCity</strong>. As per the previous step, we are exposing an additional handler, this time <strong>devlounge.lambda.FindTripsToCityHandler</strong>.</li>
</ol>
<p>Issue the following command after replacing the relevant parameters noted below:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">aws lambda create-function --function-name idevelopFindTripsToCity --runtime java8 --role &lt;LambdaRole&gt; --handler devlounge.lambda.FindTripsToCityHandler --code S3Bucket<span style="color:#f92672">=</span>&lt;S3BucketLambdaCode&gt;,S3Key<span style="color:#f92672">=</span>tripsearch-1.0.0.jar --timeout <span style="color:#ae81ff">15</span> --description <span style="color:#e6db74">&#34;TravelBuddy TripSearch microservice - FindTripsToCity&#34;</span> --memory-size <span style="color:#ae81ff">1024</span> --region ap-northeast-1
</code></pre></div><p>Replace the with the value shown in <strong>Cloudformation Outputs</strong> tab for the key <strong>S3BucketLambdaCodeBucketName</strong>. Replace the with the value shown in <strong>Cloudformation Outputs</strong> tab for the key <strong>LambdaRoleARN</strong>.</p>
<p>Confirm that you receive a success response similar to the response when you successfully created the Lambda function.</p>





<footer class=" footline" >
	
</footer>

        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="/2-spa/1-prerequisites/b/" title="AWS Cloud9 Environment"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/2-spa/3-api-gateway/" title="Create and Expose the API" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1622738044"></script>
    <script src="/js/perfect-scrollbar.min.js?1622738044"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1622738044"></script>
    <script src="/js/jquery.sticky.js?1622738044"></script>
    <script src="/js/featherlight.min.js?1622738044"></script>
    <script src="/js/highlight.pack.js?1622738044"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom-3.6.0.js?1622738044"></script>
    <script src="/js/learn.js?1622738044"></script>
    <script src="/js/hugo-learn.js?1622738044"></script>

    <link href="/mermaid/mermaid.css?1622738044" rel="stylesheet" />
    <script src="/mermaid/mermaid.js?1622738044"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-158079754-2', 'auto');
  ga('send', 'pageview');

</script>
  </body>
</html>
